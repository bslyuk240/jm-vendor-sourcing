<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>JulineMart — New Vendor Entry</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: light dark; --bg:#0b1020; --card:#111831; --muted:#9aa3b2; --line:#213050; --pri:#4f46e5; --pri-2:#6366f1; --ok:#16a34a; --err:#ef4444; }
    @media (prefers-color-scheme: light) { :root { --bg:#fbfbfe; --card:#ffffff; --muted:#52607a; --line:#e7eaf0; --pri:#4f46e5; --pri-2:#6366f1; } }
    *{box-sizing:border-box}
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:var(--bg); color:#e8edf6; }
    .max { max-width: 1100px; margin: 0 auto; padding: 24px; }
    header { display:flex; align-items:center; justify-content:space-between; gap:12px; padding: 16px 0 8px; }
    .brand { font-weight:800; letter-spacing:.3px; font-size: 18px; }
    nav a { color: #e8edf6; text-decoration:none; opacity:.85; padding:8px 12px; border-radius:10px; }
    nav a:hover { background: rgba(255,255,255,.06); }
    .sub { color: var(--muted); margin-top: 4px; }
    .card { background: var(--card); border:1px solid var(--line); border-radius: 16px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,.15); }
    h1 { margin: 0 0 6px; font-size: 22px; letter-spacing:.2px; }
    label { display:block; font-size:13px; color:var(--muted); margin-bottom:6px; }
    input, select, textarea {
      width:100%; padding:12px 14px; background:#0e1529; color:#e8edf6;
      border:1px solid var(--line); border-radius:12px; outline:none;
    }
    input:focus, select:focus, textarea:focus { border-color: var(--pri-2); box-shadow: 0 0 0 3px rgba(99,102,241,.2); }
    textarea { min-height: 90px; resize: vertical; }
    .grid { display:grid; gap:14px; grid-template-columns: repeat(3,1fr); }
    @media (max-width: 980px){ .grid{ grid-template-columns:1fr; } }
    .actions { display:flex; gap:12px; margin-top: 14px; }
    .btn { border:0; padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:600; }
    .btn-primary { background: linear-gradient(90deg, var(--pri), var(--pri-2)); color:white; }
    .btn-ghost { background: transparent; color: #e8edf6; border:1px solid var(--line); }
    .note { margin-top:8px; color:var(--muted); font-size:13px; }
    .toast { margin-top:12px; padding:10px 12px; border-radius:10px; font-size:14px; display:none; }
    .toast.ok { background: rgba(22,163,74,.15); border:1px solid rgba(22,163,74,.35); color:#b6f2c7; display:block; }
    .toast.err{ background: rgba(239,68,68,.15); border:1px solid rgba(239,68,68,.35); color:#ffd1d1; display:block; }
    footer { margin-top: 36px; color: var(--muted); font-size: 13px; text-align:center; }
    .link { color:#c7cbff; text-decoration:none; }
    .link:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <div class="max">
    <header>
      <div class="brand">JulineMart • Vendor Sourcing</div>
      <nav>
        <a href="./index.html">New Entry</a>
        <a href="./recent.html">Recent Entries</a>
      </nav>
    </header>

    <div class="card" style="margin-top:10px;">
      <h1>New Vendor Entry</h1>
      <p class="sub">Fill the form below. Images are disabled for now (for reliability).</p>

      <form id="vendorForm" style="margin-top:14px;">
        <div class="grid">
          <div>
            <label>Marketer Name *</label>
            <input name="marketerName" required />
          </div>
          <div>
            <label>Marketer Phone</label>
            <input name="marketerPhone" />
          </div>
          <div>
            <label>Marketer Email</label>
            <input name="marketerEmail" type="email" />
          </div>

          <div>
            <label>Vendor/Business Name *</label>
            <input name="vendorName" required />
          </div>
          <div>
            <label>Contact Person</label>
            <input name="contactPerson" />
          </div>
          <div>
            <label>Vendor Phone</label>
            <input name="vendorPhone" />
          </div>

          <div>
            <label>Vendor Email</label>
            <input name="vendorEmail" type="email" />
          </div>
          <div>
            <label>Business Address</label>
            <input name="businessAddress" />
          </div>
          <div>
            <label>Category *</label>
            <select name="category" required>
              <option value="">Select…</option>
              <option>Accessories</option>
              <option>Beauty/Cosmetics</option>
              <option>Electronics</option>
              <option>Fashion</option>
              <option>Groceries</option>
              <option>Home & Living</option>
              <option>Other</option>
            </select>
          </div>

          <div>
            <label>Sells Online</label>
            <select name="sellsOnline">
              <option value="">Select…</option>
              <option>Yes</option>
              <option>No</option>
            </select>
          </div>
          <div>
            <label>Where Online</label>
            <input name="whereOnline" placeholder="Instagram, WhatsApp, Website…" />
          </div>
          <div>
            <label>Interest *</label>
            <select name="interest" required>
              <option value="">Select…</option>
              <option>Yes</option>
              <option>No</option>
            </select>
          </div>

          <div>
            <label>Onboarding *</label>
            <select name="onboarding" required>
              <option value="">Select…</option>
              <option>Self Registration</option>
              <option>Marketer Assistance</option>
            </select>
          </div>
          <div>
            <label>Challenges</label>
            <input name="challenges" />
          </div>
          <div>
            <label>Comments</label>
            <textarea name="comments"></textarea>
          </div>
        </div>

        <div class="actions">
          <button class="btn btn-primary" type="submit">Save & Sync</button>
          <button class="btn btn-ghost" type="button" id="resetBtn">Reset</button>
        </div>
        <div id="toast" class="toast"></div>
        <p class="note">Required: fields marked with *.</p>
      </form>
    </div>

    <footer>
      After saving, open <a class="link" href="./recent.html">Recent Entries</a> to manage/delete.
    </footer>
  </div>

  <script>
    // ---- config
    const TOKEN = 'JMvSource_92nF7x!qA4pLz#Xt8Kd';
    const FN_URL = '/.netlify/functions/vendor-intake';

    function showToast(msg, ok=true) {
      const el = document.getElementById('toast');
      el.className = 'toast ' + (ok ? 'ok' : 'err');
      el.textContent = msg;
      el.style.display = 'block';
      setTimeout(()=>{ el.style.display='none'; }, 3000);
    }

    async function api(action, extra = {}) {
      const res = await fetch(FN_URL, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ token:TOKEN, action, ...extra })
      });
      const ct = res.headers.get('content-type') || '';
      if (ct.includes('application/json')) return res.json();
      const txt = await res.text();
      return { ok:false, error:`Non-JSON ${res.status}: ${txt.slice(0,200)}` };
    }

    document.getElementById('vendorForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const f = e.target;

      const payload = {
        id: crypto.randomUUID(), // entry_id we save in DB
        marketerName: f.marketerName.value.trim(),
        marketerPhone: f.marketerPhone.value.trim(),
        marketerEmail: f.marketerEmail.value.trim(),
        vendorName: f.vendorName.value.trim(),
        contactPerson: f.contactPerson.value.trim(),
        vendorPhone: f.vendorPhone.value.trim(),
        vendorEmail: f.vendorEmail.value.trim(),
        businessAddress: f.businessAddress.value.trim(),
        category: f.category.value,
        sellsOnline: f.sellsOnline.value,
        whereOnline: f.whereOnline.value.trim(),
        interest: f.interest.value,
        onboarding: f.onboarding.value,
        challenges: f.challenges.value.trim(),
        comments: f.comments.value.trim(),
        device: navigator.userAgent
      };

      // minimal client validation
      if (!payload.vendorName || !payload.marketerName || !payload.category || !payload.interest || !payload.onboarding) {
        showToast('Fill required fields (Vendor, Marketer, Category, Interest, Onboarding).', false);
        return;
      }

      const out = await api('create', payload);
      if (out.ok) {
        f.reset();
        showToast('Saved & synced ✓', true);
      } else {
        showToast('Save failed: ' + out.error, false);
      }
    });

    document.getElementById('resetBtn').addEventListener('click', ()=> {
      document.getElementById('vendorForm').reset();
    });

    // service worker bump to avoid stale cache
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js?v=6').catch(()=>{});
    }
  </script>
</body>
</html>
